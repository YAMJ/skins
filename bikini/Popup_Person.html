<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 Person popup</title>
        <script src="js/jQuery.js"></script>
        <script src="js/pure.js"></script>
		<!-- Used for skin language setting -->
		<script src="js/lang.js"></script>
		<!-- Used for template -->
		<script src="js/template.js"></script>	
        <link rel="stylesheet" type="text/css" href="css/Popup_Person-style.css">
    </head>
    <body onload="PersonData();" >
        <script type="text/javascript">
            function PersonData()
            {
				var	id = localStorage.getItem ("Person_id");
			// fill all value according to language setting - from yamjv3_lang_{lang}.xml
				get_lang();				
                jsonUrl = "/yamj3/api/person/" + id + ".json?dataitems=artwork,biography,filmography&sort=desc";
                var jsondata = null;
				switch (window.localStorage.getItem('back_close'))
				{
					case 'back':
						document.getElementById('back_icon').style.visibility="hidden";
						document.getElementById('close_icon').style.visibility="visible";
					break;	
					case 'close':
						document.getElementById('close_icon').style.visibility="hidden";
						document.getElementById('back_icon').style.visibility="visible";
					break;
					
				}
                console.log("Call for URL with person ID:" + id);
                console.log("URL: " + jsonUrl);

                $.ajax({
                    url: jsonUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(data)
                    {
                        jsondata = data;
					//	outputJson(data); 	
                        updateHtml(data);
						
                    }
                });
				
                return jsondata;
            }

            function updateHtml(yamjdata)
            {
            //    console.log(yamjdata);
                YAMJ_DIR = {
              //      'span.id': 'result.id',
                    'span.name': 'result.name',
                    'span.birthPlace': 'result.birthPlace',
					'span.birthDay': function(arg) {
								if (arg.context.result.birthDay) 
								{
									return arg.context.result.birthDay;
								} else {
								return nobirthday_text;
								}
							},
                    'span.biography': function(arg) {
								if (arg.context.result.biography) 
								{
									return arg.context.result.biography;
								} else {
								return nobiography_text;
								}
							},
                    'span.image': function(arg) {
                        // Check to see if there is artwork
                        if (arg.context.result.artwork) {
                            // Get the first photo from the list
                            var photo = arg.context.result.artwork[0];
                            if (photo.generatedId === 0) {
                                return "<img src=\"pictures/dummy_photo.jpg\">";
                            }
                            return "<img src=\"" + arg.context.basePhotoUrl + photo.filename + "\">";
                        } else {
                            return "<img src=\"pictures/dummy_photo.jpg\">";
                        }
                    }
                };
			  var LIST_FILMOGRAPHY = {
						'span.filmography': function(arg)
						{
							var filmography_list = arg.context.result.filmography;
							var output = filmography_label +":<br>";
						  
							// loop thru the list of filmography
							for (i = 0; i < filmography_list.length; i++) {
								temp_output = filmography_list[i].year + " - " + filmography_list[i].title + " - " + filmography_list[i].job.substring(0,1).toUpperCase() + filmography_list[i].job.substring(1).toLowerCase() + " (" + filmography_list[i].role.italics() +")<br>";
								
								if (filmography_list[i].videoDataId != -1)
									{
									  temp_output = "<a href=\"javascript:setId('" + filmography_list[i].type + "', '" + filmography_list[i].videoDataId + "')\"><img src=\"pictures\\icon-play_on.png\" ></img></a>" + temp_output ;
									}
								output = output +  temp_output;
							}
							return output;
						}
				};
				$p('.template').render(yamjdata, YAMJ_DIR);		
				$p('.result_filmography').render(yamjdata, LIST_FILMOGRAPHY);	
            }
			
			 function setId(type, id)
        {
            window.localStorage.setItem("indextype", type);
            window.localStorage.setItem("id", id);
            console.log("setId Storing value: " + type + "-" + id);
          	window.open("detail.html", "YAMJ v3 detail page", "");
        }
			function close_person ()
			{
				console.log("close_person:  style:"+window.localStorage.getItem('Style'));
				switch (window.localStorage.getItem('Style'))
				{
					case 'frame':
						parent.document.getElementById('person_display').style.visibility="hidden";
					break;	
					case 'page':
						this.window.close();
					break;
					case 'ribbon':
						this.window.close();
					break;	
					case 'popup':
						this.window.close();
					break;
					
				}
				parent.document.getElementById('person_display').style.visibility="hidden";
			} 
			function back ()
			{
				console.log ("Popup_Person: back : style: "+window.localStorage.getItem('Style'));
				switch (window.localStorage.getItem('Style'))
				{
					case 'frame':
				
					//	parent.document.getElementById('target_frame').style.display="none";
						parent.document.getElementById('target_display').style.visibility="hidden";
						parent.document.getElementById('target_display').style.height="275px";
						parent.document.getElementById('target_frame').style.height="320px";
						parent.document.getElementById('target_display').style.width="925px";
						parent.document.getElementById('target_frame').style.width="920px";
						parent.document.getElementById('target_display').style.left="200px";
						parent.document.getElementById('target_display').style.top="70px";
						parent.document.getElementById('person_frame').style.display="block";
						parent.document.getElementById('person_display').style.visibility="visible";
					break;	
					case 'page':
						this.window.close();
					break;
					case 'ribbon':
						this.window.close();
					break;
					case 'popup':
						this.window.close();
					break;
				}
				
			}	
			
			function set_context_lang_value ()
			{		}
		
		
        </script>
		
		<!-- just added to set the language value, shouldn't be displayed  -->
			<div class="results" style="visibility: hidden; display:none;">
				<table><tr><td class="Value"></td></tr></table>
			</div>
			
        <div class="template">
            <table id="headertable">
                <tr>
                 
            <!--        <td><span class="id"></span></td> -->
                    <td rowspan="4"><span class="image"></span></td>
                    
					<td>
				<div id="close_icon" onclick="close_person()" style="position: absolute; top: 0px; right: 0px;"><img src="./pictures/close2.png" width="40"/></div>
				<a id="back_icon" href="javascript:back()"><img src="./pictures/returnbutton.png" width="30px" align="left" /></a>
					<span class="name"></span>: 
                    <span class="birthPlace"></span> - 
                    <span class="birthDay"></span>
					
					
					</td>
                </tr>
                <tr>
               
                    <td><span class="biography"></span></td>
                </tr>
	
	
            </table>
        </div>
		<table class="result_filmography">
			
						<tr>
							<td><span class="filmography"></span></td>  <!-- display filmography -->
						</tr>
					
					</table>
		
		
	<!-- display source data from API if needed  -->
        <div id="sourceData"></div>		
    </body>
</html>