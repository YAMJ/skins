<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 config</title>
        <script src="js/jQuery.js"></script>
        <!-- Used for the JSON parsing -->
        <script src="js/pure.js"></script>
        <!-- Used for the paging of the index -->
        <script src="js/js.js"></script>
        <script src="js/jPages.js"></script>
		<!-- Used for skin language setting -->
		<script src="js/lang.js"></script>
		<script src="js/library.js"></script>
		<!-- Used for config  setting -->
		<script src="js/config.js"></script>
		<!-- Used for template -->
		<script src="js/template.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css">
        <!-- Used for the paging of the index -->
        <link rel="stylesheet" href="css/jPages.css">
        <!-- Used for the fancy animations -->
        <link rel="stylesheet" href="css/animate.css">
	
    </head>
    <body onload="getIndexData();">
        <script type="text/javascript">
	
//***************************************************************************************
        var select = "";
		// set default to 2 rows and 6 columns
		var Indexpopup = "";
		var LangValue = "en";
		
		
		// set a default  if 1rst time and set to the type previously selected if available 	
		var index_type = "movie,series";
			if (window.localStorage.getItem("indextype"))
				{index_type = window.localStorage.getItem("indextype");}
				else {window.localStorage.setItem("indextype", index_type);}
		var direction_temp = "ASC";
			if (window.localStorage.getItem("direction"))
				{direction_temp = window.localStorage.getItem("direction");}
				else {window.localStorage.setItem("direction", direction_temp);}			
		var method_selected	= 'MOVIE';
		var ribbon_display = 'PAGE';
	
        // This function calls the API to get the JSON data.
        // It will then update the HTML with the data and set up the paging
        function getIndexData()
        {
			console.log("getIndexData: ");
			// fill all value according to language setting - from yamjv3_lang_{lang}.xml
			get_lang();
			// fill style value 
			get_style();
			get_player();
			set_player_select_list();
			get_poster_number ();
			
		}
		function SetIndexData (search)
		{	
			direction_temp = window.localStorage.getItem("direction")
			console.log("SetIndexData: search="+search+ " method_selected="+method_selected+ " direction="+direction_temp+ " ribbon_display="+ribbon_display);	
			window.localStorage.setItem("search_index", search);	
			switch (method_selected)
				{
					case 'ALL':
						localStorage.setItem("selection", search);
						localStorage.setItem("type", 'all');
						if (ribbon_display == 'PAGE') {
							Indexpopup = window.open("index.html", "YAMJ v3 index","");
							} else {
							ouvre_popup_index('navData.html', direction_temp, method_selected, search);
							}
						break;
					case 'MOVIE':
						localStorage.setItem("selection", search);
						localStorage.setItem("type", 'movie');
						if (ribbon_display == 'PAGE') {
							Indexpopup = window.open("index.html", "YAMJ v3 index","");
							} else {
							ouvre_popup_index('navData.html', direction_temp, method_selected, search);
							}
						break;
					case 'SERIES':
						localStorage.setItem("selection", search);

						localStorage.setItem("type", 'series');
						if (ribbon_display == 'PAGE') {
							Indexpopup = window.open("index.html", "YAMJ v3 index","");
							} else {
							ouvre_popup_index('navData.html', direction_temp, method_selected, search);
							}
						break;
					case 'SEASON':
						localStorage.setItem("selection", search);
		
						localStorage.setItem("type", 'season');
						if (ribbon_display == 'PAGE') {
							Indexpopup = window.open("index.html", "YAMJ v3 index","");
							} else {
							ouvre_popup_index('navData.html', direction_temp, method_selected, search);
							}
						break;
					case 'GENRE':
						call_genreindex('all', 'true');
						break;
					case 'NAME':
						window.localStorage.setItem("search_method", 'NAME');	
						if (ribbon_display == 'PAGE') {
							call_personindex('true');
							} else {
							call_personpopup();
							}
						break;
					case 'PERSON':
						if (ribbon_display == 'PAGE') {
							call_personindex('true');
							} else {
							call_personpopup();
							}
						break;
				};
				
		
		}
		
		
		function ouvre_index(page, direction, current_type, letter_selection) 
		{
			console.log("ouvre_index: "+ page + " " + direction + " " + current_type + " " + letter_selection);
			localStorage.setItem("selection", letter_selection);
			localStorage.setItem("direction", direction);
			localStorage.setItem("type", current_type);
			Indexpopup = window.open(page, "YAMJ v3 index","");
		}
		// open a new vertical window for index list 				
		function ouvre_popup_index(page, direction, current_type, letter_selection) 
		{
			console.log("ouvre_popup_index: "+ page + " " + direction + " " + current_type + " " + letter_selection);
			localStorage.setItem("selection", letter_selection);
			localStorage.setItem("direction", direction);
			localStorage.setItem("type", current_type);
			Indexpopup = window.open(page, "YAMJv3 Navigation index","channelmode=no, menubar=no, status=no, scrollbars=yes, resizable=yes, menubar=no, location=no, left=2px, top=5px, width=160px, height=1000px");
		}

		function set_player_select_list ()
		{
							for (var i = 0; i < player_list.length; i++) {
							   $('#playerlist_to_select').append("<option value='" + player_list[i] + "'>" + player_list[i] + "</option>");
							}
		}	
		function commit_lang ()
		{
				
				if (StyleValue == 'frame') 
				{
					parent.location.reload(false);parent.nodisplay_Id('target_display');
				} else {
					window.opener.location.reload(false);window.close();
				}				
			
		}		
		
		function commit_skin ()
		{
				
				if (StyleValue == 'frame') 
				{
					parent.location.reload(false);parent.nodisplay_Id('target_display');
				} else {
					window.opener.location.reload(false);window.close();
				}				
			
		}		
		function commit_style ()
		{
				
				if (StyleValue == 'frame') 
				{
					parent.location.reload(false);parent.nodisplay_Id('target_display');
				} else {
					window.opener.location.reload(false);window.close();
				}				
				document.getElementById("StyleSetted").innerHTML=window.localStorage.getItem("Style");		
		}		
		function commit_nbrow ()
		{
				
				if (StyleValue == 'frame') 
				{
					parent.location.reload(false);parent.nodisplay_Id('target_display');
				} else {
					window.opener.location.reload(false);
				}
				
				window.close();			
		}		
		function close_config ()
			{
				switch (StyleValue)
					{
					case 'frame':
						{
							console.log("close_config:  style:"+StyleValue);								
							parent.document.getElementById('target_display').style.visibility="hidden";
						
							break;
						} 
					case 'popup':
						{
							console.log("close_config:  style:"+StyleValue);
							window.close();
							break;
						}
					case 'ribbon':
						{
							console.log("close_config:  style:"+StyleValue);
							window.close();
							break;
						}
					case 'page':
						{
							console.log("close_config:  style:"+StyleValue);
							window.close();
							break;
						}
					return;
					
				}			
							
		}
 // **********************************************  ajout parser xml ***********************		
		function get_operation_file_list ()
		{
		
			var jsonOperationUrl = "http://"+Ip_device+":8008/file_operation?arg0=list_user_storage_file&arg1=&arg2=0&arg3=100&arg4=true&arg5=true&arg6=true&arg7=";
				console.log("get_operation_file_list jsonOperationUrl: " + jsonOperationUrl);
				gestionClic(jsonOperationUrl)
		}

 
		function createRequestObject()
			{
				var http;
				if (window.XMLHttpRequest)
				{ // Mozilla, Konqueror/Safari, IE7 ...
					http = new XMLHttpRequest();
				}
				else if (window.ActiveXObject)
				{ // Internet Explorer 6
					http = new ActiveXObject("Microsoft.XMLHTTP");
				}
				return http;
			} // createRequestObject()

		function gestionClic(URL)
			{
			  var http = createRequestObject();
			  http.open('GET', URL, true);
			  http.onreadystatechange = (function ()
				{
				  if (http.readyState == 4)
				  {
					if (http.status == 200)
					{
						var device_type = new Array();
						var device_name = new Array();
						var device_path = new Array();
						var tree = http.responseXML;
						current_player = window.localStorage.getItem('Player');
						z=tree.getElementsByTagName('fileList');
						
						for(j = 0; j < z[0].getElementsByTagName('file').length; j++){
							
							device_type[j]=z[0].getElementsByTagName("device_type")[j].childNodes[0].nodeValue;
							device_name[j]=z[0].getElementsByTagName("name")[j].childNodes[0].nodeValue;
							device_path[j]=z[0].getElementsByTagName("path")[j].childNodes[0].nodeValue;
							$('#device_content').append("<table style='position: relative; '><tr><td>device type:" + device_type[j] + ", name:" +device_name[j]+ ", path:" +device_path[j]+"</td><tr></table>");
							
							console.log("gestionClic  device nb: " +j+ " type:" +device_type[j]+ " name:" +device_name[j]+ " path:" +device_path[j]);
						
							}	
					  }
					
					else
					{
					  console.log("gestionClic in get_operation_file , wrong request for IP: "+Ip_device );
					}
				  }
				});
			  http.send(null);
			} // gestionClic()
  //************************ LANGUAGE LOCAL SETTING *********************************************
		// store all value according to language setting - from yamjv3_lang_{lang}.xml - local setting 
		function set_context_lang_value ()
		{
			document.getElementById("languagelabel").innerHTML=lang_label.toUpperCase();
			document.getElementById("stylelabel").innerHTML=style_label.toUpperCase();
			document.getElementById("skinlabel").innerHTML="SKIN";
			document.getElementById("playerlabel").innerHTML=player_select.toUpperCase();
			document.getElementById("nbrow").innerHTML=nbofrow.toUpperCase();
			document.getElementById("LangSetted").innerHTML=LangValue;
			document.getElementById("StyleSetted").innerHTML=window.localStorage.getItem("Style");
			document.getElementById("PlayerSetted").innerHTML=window.localStorage.getItem("Player");
			document.getElementById("NblineSetted").innerHTML=window.localStorage.getItem("RowperPage");
			document.getElementById("SkinSetted").innerHTML=window.localStorage.getItem("skinset");
		}
        </script>
		<!-- just added to set the language value, shouldn't be displayed  -->
		<div class="results" style="visibility: hidden; display:none;">
			<table><tr><td class="Value"></td></tr></table>
		</div>
		<!-- just added to set the poster number value, shouldn't be displayed  -->
		<div class="poster_results" style="visibility: hidden; display:none;">
			<table><tr><td class="Poster_Value"></td></tr></table>
		</div>
		<div id="close_icon" onclick="close_config()"><img src="./pictures/close.png" /></div>
		<div id="info_icon" onclick="get_operation_file_list ()"><img src="./pictures/info2.png" onclick="src='./pictures/info2_on.png'" /></div> 
	<!--	<div id="info_icon" onclick="myIP();"><img src="./pictures/info2.png" onclick="src='./pictures/info2_on.png'" /></div>	-->
		<div id="device_content" ></div>
		<div id="ip" > </div>		
	
		<div id="main_index" style="left: -20px;">
			

				<!-- select language  -->
							<table>
								<tr class="tablelang">
									<td>
										
												<form><label id='languagelabel'></label>
													<select id="lang_id" onchange="update_lang(document.getElementById('lang_id').value); commit_lang();">
														<option value=""></option>
														<option value="de">de</option>
														<option value="en">en</option>
														<option value="es">es</option>
														<option value="fr">fr</option>
														<option value="it">it</option>
													</select><div id="LangSetted"></div> 
													<noscript><input type="submit" value="Submit"></noscript>
												</form>
								
									</td>
								</tr>
							</table>
				<!-- select player  -->
							<table>
								<tr class="tableplayer">
									<td>
										
												<form><label id='playerlabel'></label>
												<input list="playerlist_to_select" autocomplete="off" id="player_id" name="player_id" onchange="update_Player(document.getElementById('player_id').value);window.opener.location.reload(false);window.close();"></input>
												<datalist id="playerlist_to_select"></datalist>
												<div id="PlayerSetted"></div>	
												<input type="submit">
												</form>
									
									</td>
								</tr>
							</table>			
				<!-- select style  -->
							<table>
								<tr class="tablestyle">
									<td>
										
												<form><label id='stylelabel'></label>
													<select id="style_id" onchange="commit_style();update_Style(document.getElementById('style_id').value);">
														<option value=""></option>
														<option value="page">page</option>
														<option value="ribbon">ribbon</option>
														<option value="frame">frame</option>
														<option value="popup">popup</option>
													</select><div id="StyleSetted"></div> 
													<noscript><input type="submit" value="Submit"></noscript>
												</form>
								
									</td>
								</tr>
							</table>
	
		
				<!-- select row  -->
						
					<table>
						<tr class="tableconfig">
							<td>
								
										<form><label id='nbrow'></label>
											<select id="row_id" onchange="update_poster_number(document.getElementById('row_id').value);commit_nbrow()">
												<option value=""></option>
												<option value="0">0</option>
												<option value="1">1</option>
												<option value="2">2</option>
												<option value="3">3</option>
												<option value="4">4</option>
												<option value="5">5</option>
												<option value="6">6</option>
												<option value="99999">~</option>
											</select><div id="NblineSetted"></div>
											<noscript><input type="submit" value="Submit"></noscript>
										</form>
								
							</td>
						</tr>
					</table>
					
				<!-- select skin  -->
							<table>
								<tr class="tableskin">
									<td>
										<form><label id='skinlabel'></label>
											<select id="skin_id" onchange="commit_skin();update_Skin(document.getElementById('skin_id').value);">
												<option value=""></option>
												<option value="bikini_skin_default_">default</option>
												<option value="bikini_skin_1_">1</option>
												<option value="bikini_skin_2_">2</option>
												<option value="bikini_skin_3_">3</option>
												<option value="bikini_skin_4_">4</option>
												<option value="bikini_skin_5_">5</option>
												<option value="bikini_skin_6_">6</option>
											</select><div id="SkinSetted"></div> 
											<noscript><input type="submit" value="Submit"></noscript>
										</form>
								
									</td>
								</tr>
							</table>
			
	
		</div>
	
	<!-- display source data from API if needed  -->
        <div id="sourceData"></div>
    </body>
</html>
