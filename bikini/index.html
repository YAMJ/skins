<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 index</title>
        <script src="js/jQuery.js"></script>
        <!-- Used for the JSON parsing -->
        <script src="js/pure.js"></script>
        <!-- Used for the paging of the index -->
        <script src="js/js.js"></script>
		<script src="js/my_remote.js"></script>
        <script src="js/jPages.js"></script>
		<!-- Used for skin language setting -->
		<script src="js/lang.js"></script>
		<!-- Used for config  setting -->
		<script src="js/config.js"></script>
		<!-- Used for template -->
		<script src="js/template.js"></script>
		<script src="js/library.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css">
        <!-- Used for the paging of the index -->
        <link rel="stylesheet" href="css/jPages.css">
        <!-- Used for the fancy animations -->
        <link rel="stylesheet" href="css/animate.css">
		<!-- used for iscroll special -->
		<script type="text/javascript" src="js/iscroll.js"></script>
    </head>
    <body onload="getIndexData();">
        <script type="text/javascript">
	
//***************************************************************************************

		var select = "";
		// set default to 2 rows and 6 columns
		var RowperPageValue = 2;
		var PerPageValue = 12;
		var LangValue = "en";
		var Prefered_PageValue = "index_all";
        var jsondata = null;
		var menuleft_toggle = 0;
		var index_method = "START";
		var watched_method = "all";
		var newest_method = "";
		// get the prefered_page
		if (localStorage.getItem("prefered_page"))
			{Prefered_PageValue = localStorage.getItem("prefered_page");}
			else {localStorage.setItem("prefered_page", Prefered_PageValue);}
		// get the newest method and reset the value to ""
		if (localStorage.getItem("newest"))
			{newest_method = localStorage.getItem("newest");
			localStorage.setItem("newest", "");}
		// get the watched method 
		if (localStorage.getItem("watched"))
			{watched_method = localStorage.getItem("watched");}
		// get the search method and reset to default for the next time 
		if (localStorage.getItem("search_method"))
			{index_method = localStorage.getItem("search_method");
			localStorage.setItem("search_method", "START");}
		// set a default  if 1rst time and set to the type previously selected if available 	
		var index_type = "movie,series";
		
		// set a default direction to ASC or set to the direction previously selected if available 	
		var direction = "ASC";
			if (window.localStorage.getItem("direction"))
				{direction = window.localStorage.getItem("direction");}
				else {window.localStorage.setItem("direction", direction);}	
        // This is the directive used by pure to transform the JSON data into HTML
        // span.Title is a simple substitution of the title
        // img.Poster@src replaces the "src" attribute of the img.Poster
		var COUNT_HEADER = {
                'span.ReturnCount': function(arg) {	
					return arg.context.count+' '+results_text;
					}
            };	
		
        var LIST_DIR = {
            "div.block": {
                "result<-results": {
                     "span.title": function(arg) {
						
					if (( arg.item.artwork.POSTER[0]) && (arg.item.videoType == 'SEASON'))
						{					
						return arg.item.title + '<br> '+season_label+': ' + arg.item.season;
						} else {
							if (arg.item.videoType == 'SERIES')
								{ 
									
									return arg.item.title +'<br> '+series_label; 
									
								} else {
									return arg.item.title;
								}
						}
					},
                    "img.poster@src": function(arg) {
						// set dummy as default poster
                       var output_poster = "pictures/dummy.jpg";
                        // Check to see if there are posters
                        if (arg.item.artwork.POSTER) {
						var boucle = true;
						var poster = arg.item.artwork.POSTER; 
						// Get the first poster available from the list
						for (i = 0; boucle && i < poster.length; i++) 
							{
								if (poster[i].generatedId)
								{
									boucle = false;
									output_poster = arg.context.baseArtworkUrl + poster[i].filename;
								} 
							}
						}
						return output_poster;
                    },
		
                    "img.poster@onclick": function(arg) {
                        return "setId('" + arg.item.videoType + "', " + arg.item.id + ")";
                    },
					"img.playbutton@onclick": function(arg) {
                        return "direct_play('" + arg.item.videoType + "', " + arg.item.id + ")";
                    },
					"img.infobutton@onclick": function(arg) {
						cursor_position (); 
                        return "direct_info('" + arg.item.videoType + "', " + arg.item.id + ")";
                    },
					"img.watched_small@src": function(arg)
					{
						if (arg.item.watched) 
						{return "./pictures/watched.png";} else
						{return "./pictures/unwatched.png";}
					}
                }
            }
        };
	
        function setId(type, id)
        {
            window.localStorage.setItem("indextype", type);
            window.localStorage.setItem("id", id);
            console.log("setId Storing value: " + type + "-" + id);
            window.location.href="detail.html";
        }

        // This function calls the API to get the JSON data.
        // It will then update the HTML with the data and set up the paging
        function getIndexData()
        {
			// load the new scolling method for the id and class selected 
			loaded_iscroll ();
			// fill all value according to language setting - from yamjv3_lang_{lang}.xml
			get_lang();
			get_style();
			get_player();
			get_prefered_page();
			
			if (window.localStorage.getItem("indextype"))
				{index_type = window.localStorage.getItem("indextype");}
				else {window.localStorage.setItem("indextype", index_type);}
           
		
			switch (index_type.toLowerCase())
				{
					case 'movie,series':
						selected_index = all_select.toUpperCase();
						break;
					case 'movie':
						selected_index = movie_select.toUpperCase();
						break;
					case 'series':
						selected_index = series_select.toUpperCase();
						break;
					case 'season':
						selected_index = season_select.toUpperCase();
						break;
					default :
						selected_index = all_select.toUpperCase();
						window.localStorage.setItem("indextype", 'movie,series');
				};
				switch (watched_method)
				{
					case 'all':
						selected_index = selected_index ;
						break;
					case 'true':
						selected_index = selected_index + "(" + watched_select.toUpperCase() + ") ";
						break;
					case 'false':
						selected_index = selected_index + "(" + unwatched_select.toUpperCase() + ") ";
						break;
					
					default :
						selected_index = selected_index;
				};
				
				
				
				
			 var jsonUrl = "/yamj3/api/index/video.json?type="+index_type+"&sortby=title&sortdir="+direction;	
					if (window.localStorage.getItem("yearselected") == 'true' && window.localStorage.getItem("selection")) 
								{
									jsonUrl = jsonUrl + "&include=year-"+window.localStorage.getItem("selection");
									window.localStorage.setItem("yearselected", 'false');
									window.localStorage.setItem("selection", "");
									window.localStorage.setItem("search_index", "");	
								} else {
				
								if (window.localStorage.getItem("search_index"))
								{
							
										selected_index = selected_index + " (" +window.localStorage.getItem("search_index").toUpperCase() + ")"
										
										jsonUrl = jsonUrl + "&search=" + window.localStorage.getItem("search_index") + "&field=title&mode="+index_method;
										window.localStorage.setItem("search_index", "");	
									}
								}
								
				jsonUrl += "&artwork=poster&watched=" + watched_method;
				if (newest_method != '' && newest_method != '0')
				{
					jsonUrl += "&include=newest-" + newest_method;
					selected_index = selected_index + ' new:' + newest_method;
				}
				
				$('#printsearch').html(selected_index);
				console.log("Index getIndexData URL: " + jsonUrl);

				$.ajax({
                url: jsonUrl,
                async: false,
                dataType: 'jsonp',
                'success': function(data)
                {
                    jsondata = data;
				//	 outputJson(data); 		
                    updateHtml(data);
					get_poster_number ();
					console.log("GetIndexData: perPageValue="+perPageValue+" paging:"+ window.localStorage.getItem('Paging'));
                 if (window.localStorage.getItem("Paging") == 'true') { 	
						pageData(perPageValue);}
                }
            });
            return jsondata;
        }
			
        // Run the pure.js function to render the data into the HTML template
        // div.row is the part of the template to apply it too.
        // "row" is a CLASS attribute, not the id.
        function updateHtml(yamjdata)
        {
			$p('.count_return_index').render(yamjdata, COUNT_HEADER);	
            $p('div.row').render(yamjdata, LIST_DIR);
        }


		function SetIndexData (search)
		{		
				window.localStorage.setItem("search_index", search);
				window.location.reload();
		
		}
// ****************************** id or class with iscroll **************************************************************
	var myScroll;
	function loaded_iscroll () {
	myScroll = new IScroll('#container_menu_left', { scrollX: false, scrollY: true, mouseWheel: true, click: true });
	}
	//   document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
  //************************ LANGUAGE LOCAL SETTING *********************************************
		// store all value according to language setting - from yamjv3_lang_{lang}.xml - local setting 
		function set_context_lang_value ()
		{
			document.getElementById("allselect").innerHTML=all_select.toUpperCase();
			document.getElementById("movieselect").innerHTML=movie_select.toUpperCase();
			document.getElementById("serieselect").innerHTML=series_select.toUpperCase();
			document.getElementById("seasonselect").innerHTML=season_select.toUpperCase();
			document.getElementById("genreindex").innerHTML=genre_select.toUpperCase();
			document.getElementById("studioindex").innerHTML=studio_select.toUpperCase();
			document.getElementById("personindex").innerHTML=person_select.toUpperCase();
			document.getElementById("configindex").innerHTML=config_select.toUpperCase();
			document.getElementById("searchindex").innerHTML=search_select.toUpperCase();
			document.getElementById("remoteselect").innerHTML=remote_label.toUpperCase();
		//	document.getElementById("allgenre").innerHTML=all_genre.toUpperCase();
		//	document.getElementById("moviegenre").innerHTML=movie_select.toUpperCase();
		//	document.getElementById("seriesgenre").innerHTML=series_select.toUpperCase();
		//	document.getElementById("seasongenre").innerHTML=season_select.toUpperCase();
			document.getElementById("yamj3select").innerHTML="YAMJ3";
			document.getElementById("genrelistselect").innerHTML=genrelist_select.toUpperCase();
			document.getElementById("certificationindex").innerHTML=certification_label.toUpperCase();
			document.getElementById("ratingindex").innerHTML=rating_label.toUpperCase();
			document.getElementById("videosourceindex").innerHTML=source_label.toUpperCase();
			document.getElementById("boxsetindex").innerHTML=boxset_label.toUpperCase();
			document.getElementById("countryindex").innerHTML=country_label.toUpperCase();
			document.getElementById("awardsindex").innerHTML=awards_label.toUpperCase();
		//	document.getElementById("watchedselect").innerHTML=watched_select.toUpperCase();
		//	document.getElementById("option_watchedselect").innerHTML=watched_select.toLowerCase();
		//	document.getElementById("option_unwatchedselect").innerHTML=unwatched_select.toLowerCase();
		//	document.getElementById("option_allwatchedselect").innerHTML=all_label.toLowerCase();
		}
        </script>
	<div class="index_header"> 
        <div id="logo_index">
			<td>
				<ul id="home_left_up">
					<li><a href="javascript:ouvre_prefered_page()" id="li_home_left"></a></li>
				</ul>
			</td>
			<div class="info_config"><a href="javascript:ouvre_info_config()" ><img src="pictures/info2.png" height="30px" width="30px" style="position: absolute; top: 1px; left: 75px;" /></a></div>
			<div class="show_index"><span id="printsearch"></span></div>
			<div class="count_return_index">
                   <span class="ReturnCount"></span> 
			</div>
			<!-- just added to set the language value, shouldn't be displayed  -->
			<div class="results" style="visibility: hidden; display:none;">
				<table><tr><td class="Value"></td></tr></table>
			</div>
			<!-- just added to set the poster number value, shouldn't be displayed  -->
			<div class="poster_results" style="visibility: hidden; display:none;">
				<table><tr><td class="Poster_Value"></td></tr></table>
			</div>
		
		</div >	
            <!--Navigation Holder-->
        <div class="holder"></div>
	</div>
        <!--Data Items Container-->
        <div id="container" >
            <div id="yRow" class="row">
                <div id="yBlock" class="block">
					<img class="poster" src="" />
                    <img class="playbutton" src="pictures/next.png" onmouseout="src='pictures/next.png'" onmouseover="src='pictures/nextSelect.png'" />
					<img class="infobutton" src="pictures/info2_on.png" onmouseout="src='pictures/info2_on.png'" onmouseover="src='pictures/info.png'" />
					<img class="watched_small" src="" />
					<br>
                    <span class="title"></span>
                </div>
                <br />
            </div>
        </div>
	<!-- left menu with icon -->
	<img id="open_menu_left" src="pictures/icon-open_frame.png" style="position:absolute; top: 380px; left: 0px; z-index:12; visibility: visible;" height="100px" width="130px" onclick="toggle_menu_left ()" />
	<img id="close_menu_left" src="pictures/icon-close_frame.png" style="position:absolute; top: 380px; left: 78px; z-index:12; visibility: hidden;" height="110px" width="130px" onclick="toggle_menu_left ()" />
	<div id="container_menu_left" style="top:40px;">			
		<ul id="monFormMenu" style="margin: 0px;">
	
				<li><a href="javascript:ChangeIndex('movie,series')">
							<img src="pictures/icon/home_all_rv8.png" height="80px"  width="80px" alt="tv movie" />
						</a><div id="allselect"></div>
				</li>
				<li><a href="javascript:ChangeIndex('movie')">
							<img src="pictures/icon/home_movies_rv8.png" height="80px"  width="80px" alt="movie" align="top" />
						</a><div id="movieselect"></div>
				</li>
				<li><a href="javascript:ChangeIndex('series')">
							<img src="pictures/icon/home_tv shows_rv8.png" height="80px"  width="80px" alt="tv" />
						</a><div id="serieselect"></div>
				</li>
				<li><a href="javascript:ChangeIndex('season')">
							<img src="pictures/icon/home_apps_rv8.png" height="100px"  width="100px" style="position: relative; left:-10px" alt="season" />
						</a><div id="seasonselect"></div>
				</li>
				<li><a href="javascript:call_personindex('false')">
							<img src="pictures/icon/home_person_rv8.png" height="80px"  width="80px" alt="person"  />
						</a><div id="personindex"></div>
				</li>
				<li><a href="javascript:call_genreindex(index_type, 'false')">
							<img src="pictures/icon/home_genres2_rv8.png" height="80px"  width="80px" alt="genre" />
						</a><div id="genreindex"></div>
				</li>
				<li><a href="javascript:call_countryindex(index_type, 'false')">
							<img src="pictures/icon/home_country_rv8.png" height="80px"  width="80px" alt="country" />
						</a><div id="countryindex"></div>
				</li>
				<li><a href="javascript:call_awardsindex(index_type, 'false')">
							<img src="pictures/icon/home_awards_rv8.png" height="80px"  width="80px" alt="awards" />
						</a><div id="awardsindex"></div>
				</li>
				<li><a href="javascript:ouvre_popup_search(StyleValue)">
							<img src="pictures/icon/find.png" height="60px" width="65px" style="padding-left:10px" alt="find" />
						</a><div id="searchindex"></div>
				</li>
				<li><a href="javascript:call_studioindex(index_type, 'false')">
							<img src="pictures/icon/Studio.png" height="60px"  width="60px" style="position: relative; left:10px" alt="studio"  />
						</a><div id="studioindex"></div>
				</li>
				<li><a href="javascript:call_ratingindex(index_type, 'false')">
							<img src="pictures/icon/home_rating_rv8.png" height="80px"  width="80px" alt="rating"  />
						</a><div id="ratingindex"></div>
				</li>
				<li><a href="javascript:call_certificationindex(index_type, 'false')">
							<img src="pictures/icon/home_certification_rv8.png" height="90px"  width="100px"  style="position: relative; left:-10px" alt="certification"  />
						</a><div id="certificationindex"></div>
				</li>
				<li><a href="javascript:call_videosourceindex(index_type, 'false')">
							<img src="pictures/icon/home_videosource_rv8.png" height="80px"  width="80px" style="position: relative; left:0px" alt="videosource"  />
						</a><div id="videosourceindex"></div>
				</li>
				<li><a href="javascript:call_boxsetindex(index_type, 'false')">
							<img src="pictures/icon/home_set_rv8.png" height="100px"  width="100px" style="position: relative; left:-10px" alt="set"  />
						</a><div id="boxsetindex"></div>
				</li>
				<li><a href="javascript:ouvre_config(StyleValue)">
							<img src="pictures/icon/settings.png" height="80px" width="100px" style="padding-left:5px" alt="setting" />
						</a><div id="configindex"></div>
				</li>
				<li><a href="javascript:ouvre_yamj3(); ">
							<img src="pictures/icon/home.png" height="80px"  width="80px" alt="home" />
						</a><div id="yamj3select"></div>
				</li>
				<li><a href="javascript:ouvre_genrelist(); ">
							<img src="pictures/icon/list_genre.png" height="80px"  width="80px" alt="liste fenre" />
						</a><div id="genrelistselect"></div>
				</li>
				<li><a href="javascript:ouvre_remote(); ">
							<img src="pictures/icon/remote.png" height="70px"  width="70px" style="position: relative; left:6px" alt="remote" />
						</a><div id="remoteselect"></div>
				</li>
		</ul>
	</div> 
	<div id="main_index">			
		<form id="monFormGenre">
				<table align="right" >
					<tr>
						<td>
							<a href="javascript:NewestSelection('index.html', window.localStorage.getItem('New'))"><img src="pictures/icon/home_new_rv8.png" height="50px"  width="50px" alt="newest" /></a>
						</td>
						<td>							
							<a href="javascript:BoxsetSelection('navBoxset.html')"><img src="pictures/icon/home_set_rv8.png" height="50px"  width="50px" alt="boxset" /></a>
						</td>
						<td>							
							<a href="javascript:WatchedSelection('index.html', 'all')"><img src="pictures/icon/home_watched_rv8.png" height="50px"  width="50px" alt="allwatched" /></a>
						</td>
						<td>
							<a href="javascript:WatchedSelection('index.html', 'true')"><img src="pictures/watched.png" height="20px" width="20px" alt="watched" /></a>
							<a href="javascript:WatchedSelection('index.html', 'false')"><img src="pictures/unwatched.png" height="20px" width="20px" alt="unwatched" /></a>	 
						</td>
					</tr>
				</table>
		</form>
	</div>	
	<!-- display infobox -->
		<button id="infobox" onclick="javascript:start_playing ()"></button>
	<!-- display Remote -->
		<div id="remote" style="visibility: hidden; ">
			<iframe src="" name="remote_frame" resizable="yes" id="remote_frame" scrolling="yes" frameborder="0" style="overflow:auto; width:430px; height:660px;" allowTransparency="true"></iframe>
		</div>	
	<!-- display config / search -->
		<div id="target_display" style="visibility: hidden; ">		
			<iframe src="" name="target_frame" resizable="yes" id="target_frame" scrolling="no" frameborder="1" style="overflow:hidden; width:1050px; height:320px;" allowTransparency="true"></iframe>
		</div>
	<!-- display detail  -->
		<div id="detail_display" style="visibility: hidden; position: absolute; top: 100px; left: 150px;">		
			<iframe src="" name="detail_frame" resizable="yes" id="detail_frame" scrolling="no" frameborder="1" style="overflow:hidden; width:960px; height:540px;" allowTransparency="true"></iframe>
		</div>	
	<!-- display Movie -->
		<div id="movie_display" style="visibility: hidden; ">
			<iframe src="" name="movie_frame" resizable="yes" id="movie_frame" scrolling="yes" frameborder="1" style="overflow:auto; width:1245px; height:265px;" allowTransparency="true"></iframe>
		</div>	
	<!-- display person -->
		<div id="person_display" style="visibility: hidden; ">	
			<iframe src="" name="person_frame" resizable="yes" id="person_frame" scrolling="yes" frameborder="1" style="overflow:auto; width:1220px; height:335px;" allowTransparency="true"></iframe>
		</div>
	<!-- display source data from API if needed  -->
        <div id="sourceData"></div>
    </body>
</html>
