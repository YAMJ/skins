<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 Boxset index</title>
        <script src="js/jQuery.js"></script>
        <!-- Used for the JSON parsing -->
        <script src="js/pure.js"></script>
        <!-- Used for the paging of the index -->
        <script src="js/js.js"></script>
		<script src="js/my_remote.js"></script>
        <script src="js/jPages.js"></script>
		<!-- Used for skin language setting -->
		<script src="js/lang.js"></script>
		<!-- Used for config  setting -->
		<script src="js/config.js"></script>		
		<!-- Used for template -->
		<script src="js/template.js"></script>
		<script src="js/library.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css">
        <!-- Used for the paging of the index -->
        <link rel="stylesheet" href="css/jPages.css">
        <!-- Used for the fancy animations -->
        <link rel="stylesheet" href="css/animate.css">
		<!-- used for iscroll special -->
		<script type="text/javascript" src="js/iscroll.js"></script>
    </head>
    <body onload="getIndexData();animate_watched ();">
        <script type="text/javascript">
			
//***************************************************************************************
		var show_sorted = false;
		var show_watched = false;
		var show_type = false;
		// set default to 2 rows and 6 columns
		var RowperPageValue = 2;
		var PerPageValue = 12;
        var jsondata = null;
		var menuleft_toggle = 0;
		var boxset_id = "";
		var boxset_name = ""; 
		var Prefered_PageValue = "index_all";
		var	display_Boxset = "";
		var watched_method = "all";
		var nbre_translate_path = 0;
		// get the prefered_page
		if (localStorage.getItem("prefered_page"))
			{Prefered_PageValue = localStorage.getItem("prefered_page");}
			else {localStorage.setItem("prefered_page", Prefered_PageValue);}
		// get the watched method 
		if (localStorage.getItem("watched"))
			{watched_method = localStorage.getItem("watched");}
		
		// get the genre and name id and reset to default for the next time 
		if (localStorage.getItem("Boxset_id"))
			{boxset_id = localStorage.getItem("Boxset_id");
			}
		if (localStorage.getItem("Boxset_name"))
			{boxset_name = localStorage.getItem("Boxset_name");
			}
		var index_type = "all";
			if (window.localStorage.getItem("indextype"))
				{index_type = window.localStorage.getItem("indextype");}
				else {window.localStorage.setItem("indextype", index_type);}
		var direction = "ASC";
			if (window.localStorage.getItem("direction"))
				{direction = window.localStorage.getItem("direction");}
				else {window.localStorage.setItem("direction", direction);}	
		var sort_type = "title"; 
			if (window.localStorage.getItem("sort_indextype"))
				{sort_type = window.localStorage.getItem("sort_indextype");}
				else {window.localStorage.setItem("sort_indextype", sort_type);}			
        // This is the directive used by pure to transform the JSON data into HTML
        // span.Title is a simple substitution of the title
        // img.Poster@src replaces the "src" attribute of the img.Poster
		var COUNT_HEADER = {
                'span.ReturnCount': function(arg) {	
					return arg.context.count+' '+ window.localStorage.getItem('results_text');
					}
            };	
		
        var LIST_DIR = {
            "div.block": {
                "member<-results": {
                     "span.title": function(arg) {
						return arg.item.title + ' (' + arg.item.videoYear + ')';
					},
                    "img.poster@src": function(arg) {
					     	// set dummy as default poster
                       var output_poster = "pictures/dummy.jpg";
                        // Check to see if there are posters
                        if (arg.item.artwork.POSTER) {
						var boucle = true;
						var poster = arg.item.artwork.POSTER; 
						// Get the first poster available from the list
						for (i = 0; boucle && i < poster.length; i++) 
							{
								if (poster[i].generatedId != 0)
								{
									boucle = false;
									output_poster = arg.context.baseArtworkUrl + poster[i].filename;
								} 
							}
						}
						return output_poster;
                    },
                    "img.poster@onclick": function(arg) {
                        return "setId('" + arg.item.videoType + "', " + arg.item.id + ")";
                    }, 
					"img.playbutton@onclick": function(arg) {
                        return "direct_play('" + arg.item.videoType + "', " + arg.item.id + ")";
                    }, 
					"img.infobutton@onclick": function(arg) {
						cursor_position (); 
                        return "direct_info('" + arg.item.videoType + "', " + arg.item.id + ")";
                    },
					"img.watched_small@src": function(arg)
					{
						if (arg.item.watched) 
						{return "./pictures/watched.png";} else
						{return "./pictures/unwatched.png";}
					},
					"img.watched_small@onmouseout": function(arg)
					{
						if (arg.item.watched) 
						{return "src='pictures/watched.png'";} else
						{return "src='pictures/unwatched.png'";}
					},
					"img.watched_small@onclick": function(arg)
					{
						return "toggle_watched (" +arg.item.watched + ", " + arg.item.id + ", '" + arg.item.videoType + "'); " ;
					},
					"img.watched_small@title": function(arg)
					{
						if (arg.item.watched) 
						{return window.localStorage.getItem('watched_select').toLowerCase();} else
						{return window.localStorage.getItem('unwatched_select').toLowerCase();}
					}
                }
            }
        };

        function setId(type, id)
        {
	
            window.localStorage.setItem("indextype", type);
            window.localStorage.setItem("id", id);
            console.log("Storing value: " + type + "-" + id);
            window.location.href="detail.html";
        }

        // This function calls the API to get the JSON data.
        // It will then update the HTML with the data and set up the paging
        function getIndexData()
        {

		// fill all value according to language setting - from yamjv3_lang_{lang}.xml
			get_lang();
			get_style();
			get_player();
			get_prefered_page();
			
			var jsonUrl = "/yamj3/api/index/video.json?include=boxset-"+boxset_id+"&dataitems=member,artwork&artwork=POSTER"+"&watched="+watched_method+"&sortby="+sort_type+"&sortdir="+direction;
			display_Boxset = window.localStorage.getItem('boxset_label').toUpperCase()+ ": " + boxset_name.toUpperCase();
		
			switch (watched_method)
				{
					case 'all':
						display_Boxset = display_Boxset ;
						$('#watched_all img').css('background-color', 'green');
						$('#watched_true img').css('background-color', '');
						$('#watched_false img').css('background-color', '');
						break;
					case 'true':
						display_Boxset = display_Boxset + "(" + window.localStorage.getItem('watched_select').toUpperCase() + ") ";
						$('#watched_all img').css('background-color', '');
						$('#watched_true img').css('background-color', 'green');
						$('#watched_false img').css('background-color', '');
						break;
					case 'false':
						display_Boxset = display_Boxset + "(" + window.localStorage.getItem('unwatched_select').toUpperCase() + ") ";
						$('#watched_all img').css('background-color', '');
						$('#watched_true img').css('background-color', '');
						$('#watched_false img').css('background-color', 'green');
						break;
					
					default :
						display_Boxset = display_Boxset;
				};
				if (sort_type == 'title') 
					{
						display_Boxset = display_Boxset + "&nbsp;-&nbsp;" + window.localStorage.getItem('title_label');
						$('#sort_title img').css('background-color', 'green');
						$('#sort_year img').css('background-color', '');
					}
					else {
							display_Boxset = display_Boxset + "&nbsp;-&nbsp;" + window.localStorage.getItem('year_label');
							$('#sort_year img').css('background-color', 'green');
							$('#sort_title img').css('background-color', '');
						}
				if (direction == 'ASC') 
					{
						display_Boxset = display_Boxset +  ","+ window.localStorage.getItem('asc_label'); 
						$('#sort_asc img').css('background-color', 'green');
						$('#sort_desc img').css('background-color', '');
					}
					else {
							display_Boxset = display_Boxset +  ","+ window.localStorage.getItem('desc_label') ; 
							$('#sort_desc img').css('background-color', 'green');
							$('#sort_asc img').css('background-color', '');
						}
	//			if (display_Boxset.length > 45)
	//				{$('#printsearch').html(display_Boxset.toLowerCase());}
	//				else {$('#printsearch').html(display_Boxset.toUpperCase());}
					
				var temp_style = "1.4vw"
					
					if (display_Boxset.length > 35)	{temp_style = "1.4vw";}
					if (display_Boxset.length > 40)	{temp_style = "1.35vw";}
					if (display_Boxset.length > 44)	{temp_style = "1.3vw";}
					if (display_Boxset.length > 51)	{temp_style = "1.25vw";}
					if (display_Boxset.length > 57)	{temp_style = "1.2vw";}
					if (display_Boxset.length > 61)	{temp_style = "1.15vw";}
					if (display_Boxset.length > 65)	{temp_style = "1.1vw";}
					if (display_Boxset.length > 69)	{temp_style = "1.05vw";}
					if (display_Boxset.length > 72)	{temp_style = "1vw";}
					if (display_Boxset.length > 74)	{temp_style = "0.95vw";}
					$(".show_index_boxset").css("font-size", temp_style);
					$('#printsearch').html(display_Boxset);

				console.log("index_boxset getIndexData URL: " + jsonUrl);
				
            $.ajax({
                url: jsonUrl,
                async: false,
                dataType: 'jsonp',
                'success': function(data)
                {
                    jsondata = data;
				//	 outputJson(data); 	
                    updateHtml(data);
					get_poster_number ();
                    console.log("GetIndexData: perPageValue="+perPageValue+" paging:"+ window.localStorage.getItem('Paging'));
					if (window.localStorage.getItem("Paging") == 'true') {pageData(perPageValue);}
                }
            });
            return jsondata;
        }

        // Run the pure.js function to render the data into the HTML template
        // div.row is the part of the template to apply it too.
        // "row" is a CLASS attribute, not the id.
        function updateHtml(yamjdata)
        {
			$p('.count_return_boxset').render(yamjdata, COUNT_HEADER);	
            $p('div.row').render(yamjdata, LIST_DIR);
        }

	
	

//************************ LANGUAGE LOCAL SETTING *********************************************		
		// store all value according to language setting - from yamjv3_lang_{lang}.xml - local setting
		function set_context_lang_value ()
		{
			document.getElementById("watched_all").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('watched_select').toLowerCase()+'&'+window.localStorage.getItem('unwatched_select').toLowerCase();
			document.getElementById("watched_true").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('watched_select').toLowerCase();
			document.getElementById("watched_false").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('unwatched_select').toLowerCase();
			document.getElementById("watched_item").attributes.getNamedItem("data-tip-item").value=window.localStorage.getItem('watched_select').toLowerCase();
			document.getElementById("sort_year").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('year_label').toLowerCase();
			document.getElementById("search_function").attributes.getNamedItem("data-tip-search").value=window.localStorage.getItem('search_select').toLowerCase();
			document.getElementById("new_function").attributes.getNamedItem("data-tip-search").value=window.localStorage.getItem('new_').toLowerCase();
			document.getElementById("sort_asc").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('asc_label').toLowerCase();
			document.getElementById("sort_desc").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('desc_label').toLowerCase();
			document.getElementById("sort_title").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('title_label').toLowerCase();
			document.getElementById("sort_item").attributes.getNamedItem("data-tip-item").value=window.localStorage.getItem('sort_label').toLowerCase();
		//	document.getElementById("movie_series_type").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('all_label').toLowerCase();
		//	document.getElementById("movie_type").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('movie_label').toLowerCase();
		//	document.getElementById("series_type").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('series_label').toLowerCase();
		//	document.getElementById("season_type").attributes.getNamedItem("data-tip-sort").value=window.localStorage.getItem('season_label').toLowerCase();
		//	document.getElementById("type_item").attributes.getNamedItem("data-tip-item").value=window.localStorage.getItem('video_label').toLowerCase();
			
			document.getElementById("info_config").attributes.getNamedItem("data-tip2").value=window.localStorage.getItem('info_label').toLowerCase();
			document.getElementById("li_home_left").attributes.getNamedItem("data-tip2").value=window.localStorage.getItem('prefered_page').toLowerCase();

			document.getElementsByClassName("playbutton")[0].title=window.localStorage.getItem('play_label').toLowerCase();
			document.getElementsByClassName("infobutton")[0].title=window.localStorage.getItem('info_label').toLowerCase();
		}
        </script>
	
    <div class="index_header"> 
			<a href="javascript:ouvre_prefered_page()" id="li_home_left" data-tip2="prefered page"></a>
			<a id="info_config" data-tip2="info" href="javascript:ouvre_info_config()" ></a>
			<div class="show_index_boxset"><span id="printsearch"></span></div>
			<div class="count_return_boxset">
                   <span class="ReturnCount"></span> 
			</div>
		<!-- just added to set the language value, shouldn't be displayed  -->
			<div class="results" style="visibility: hidden; display:none;">
				<table><tr><td class="Value"></td></tr></table>
			</div>
			<!-- just added to set the poster number value, shouldn't be displayed  -->
			<div class="poster_results" style="visibility: hidden; display:none;">
				<table><tr><td class="Poster_Value"></td></tr></table>
			</div>
		
		<div class="test">
					<td><span class="postertest"></span></td>
		</div> 
		<div id="index_tools_index" >			

						<ul id="search_section">
							<a id="search_function" style="left: 0vw; z-index: 10;" data-tip-search="search" href="javascript:ouvre_popup_search(StyleValue, false)">
								<img src="pictures/find.png" style="height: 2.2vw; width: 2.4vw;"  alt="find" />
							</a>
						</ul>
						<ul id="new_section">
							<a id="new_function" style="left: 1vw;" data-tip-search="new" href="javascript:NewestSelection('index_Boxset.html', window.localStorage.getItem('New'))"><img src="pictures/new.png" alt="newest" style="left: 0px; width: 3.2vw; height: 2.2vw;" /></a>
						</ul>
						<ul id="watch_section">
							<li><a id="watched_item" data-tip-item="watched"><img src="pictures/watched_unwatched_sort.png" alt="allwatched" style="height: 2.2vw;" onclick="toggle_show_watched()" /></a></li>							
							<li><a id="watched_all" data-tip-sort="watched all" href="javascript:WatchedSelection('index_Boxset.html', 'all')"><img src="pictures/watched_unwatched_sort.png" alt="allwatched" /></a></li>
							<li><a id="watched_true" data-tip-sort="watched" href="javascript:WatchedSelection('index_Boxset.html', 'true')"><img src="pictures/watched_sort.png" alt="watched" /></a></li>
							<li><a id="watched_false" data-tip-sort="unwatched"  href="javascript:WatchedSelection('index_Boxset.html', 'false')"><img src="pictures/unwatched_sort.png"  alt="unwatched" /></a></li>
						</ul>
						<ul  id="sort_section">
							<li><a id="sort_item" data-tip-item="sort" alt="sort"><img  src="pictures/sort.png" style="height: 2.2vw; width: 2.9vw" onclick="toggle_show_sort()"/></a></li>
							<li><a id="sort_desc" data-tip-sort="descending" href="javascript:SortDirection('DESC','index_Boxset.html')" ><img src="pictures/sort_desc.png" alt="sort_desc" /></a></li>
							<li><a id="sort_asc" data-tip-sort="ascending" href="javascript:SortDirection('ASC','index_Boxset.html')" ><img src="pictures/sort_asc.png" alt="sort_asc"/></a></li>
							<li><a id="sort_year" data-tip-sort="year" href="javascript:SortIndex('videoYear','index_Boxset.html')" ><img src="pictures/year_sort.png" alt="sort_year" /></a></li>
							<li><a id="sort_title" data-tip-sort="title" href="javascript:SortIndex('title','index_Boxset.html')" ><img src="pictures/title_sort.png" alt="sort_title"/></a></li>
						</ul>
				<!--		<ul id="type_section" >
							<li><a id="type_item" data-tip-item="type" alt="type"><img  src="pictures/home_movies.png" style="height: 2.4vw; width: 3.1vw;" onclick="toggle_show_type()"/></a></li>
							<li><a id="movie_series_type" data-tip-sort="movie,series" href="javascript:open_self_index('movie,series', 'index_Boxset.html')"><img src="pictures/icon/home_all_rv8.png" height="45" width="45" alt="tv movie"/><a></li>
							<li><a id="movie_type" data-tip-sort="movie" href="javascript:open_self_index('movie', 'index_Boxset.html')"><img src="pictures/icon/home_movies_rv8.png" height="45x" width="45" alt="movie"/></a></li>
							<li><a id="series_type" data-tip-sort="series" href="javascript:open_self_index('series', 'index_Boxset.html')"><img src="pictures/icon/home_tv_shows_rv8.png" height="45" width="45" alt="tv" /></a></li>
							<li><a id="season_type" data-tip-sort="season" href="javascript:open_self_index('season', 'index_Boxset.html')"><img src="pictures/icon/home_apps_rv8.png" height="45" width="45" alt="season" /></a></li>
						</ul>
				-->
				
			</div>	
		<div class="directplay" style="display:none">
			<span class="filepath"></span>
		</div>
        <!--Navigation Holder-->
        <div class="holder"></div>
	</div>
<!-- add left menu dynamically from a separate file --> 
	<div >
      <object data="include_left_menu.html" type="text/html" id="my_left_menu"></object>
    </div>
        <!--Data Items Container-->
        <div id="container">
            <div id="yRow" class="row">
                <div id="yBlock" class="block">
					<img class="poster" src="pictures/dummy.png" alt="poster"  />
                    <img class="playbutton" src="pictures/next.png" onmouseout="src='pictures/next.png'" onmouseover="src='pictures/nextSelect.png'" alt="next" title="play"></img>
					<img class="infobutton" src="pictures/info2_on.png" onmouseout="src='pictures/info2_on.png'" onmouseover="src='pictures/info.png'" alt="info" title="info" ></img>
					<img class="watched_small" src="pictures/empty.png" alt="watched" onmouseout="src='pictures/empty.png'" data-tip="watch"></img>
					<br>
                    <span class="title" ></span>
                </div>
                <br />
            </div>
        </div>
	<!-- display infobox -->
		<button id="infobox" onclick="javascript:start_playing ()"></button>
	<!-- display config -->
		<div id="target_display" style="visibility: hidden; ">		
			<iframe src="" name="target_frame" resizable="yes" id="target_frame" scrolling="no" frameborder="1" style="overflow:hidden; width:1050px; height:320px;" allowTransparency="true"></iframe>
		</div>
	<!-- display detail  -->
		<div id="detail_display" style="visibility: hidden; position: absolute; top: 15%; left: 16%;">		
			<iframe src="" name="detail_frame" resizable="yes" id="detail_frame" scrolling="no" frameborder="1" style="overflow:hidden;  width:71vw; height:43vw;" allowTransparency="true"></iframe>
		</div>
		<!-- display Movie -->
		<div id="movie_display" style="visibility: hidden; ">
			<iframe src="" name="movie_frame" resizable="yes" id="movie_frame" scrolling="yes" frameborder="1" style="overflow:auto; width:1245px; height:265px;" allowTransparency="true"></iframe>
		</div>	
	<!-- display person -->
		<div id="person_display" style="visibility: hidden; ">	
			<iframe src="" name="person_frame" resizable="yes" id="person_frame" scrolling="yes" frameborder="1" style="overflow:auto; width:1220px; height:335px;" allowTransparency="true"></iframe>
		</div>	
	<!-- display source data from API if needed  -->
        <div id="sourceData"></div>
    </body>
</html>
