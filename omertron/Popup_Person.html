<html>
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 Person popup</title>
        <script src="js/jquery.min.js"></script>
        <script src="js/pure.js"></script>
        <link rel="stylesheet" type="text/css" href="css/Popup_Person-style.css">
    </head>
    <body onload="PersonData();" >
        <script type="text/javascript">
            function PersonData()
            {
				var	id = localStorage.getItem ("Person_id");
			// fill all value according to language setting - from yamjv3_lang_{lang}.xml
				set_skin_language();				
                jsonUrl = "http://localhost:8888/yamj3/api/person/" + id + ".json?dataitems=artwork,biography";
                var jsondata = null;

                console.log("Call for URL with person ID:" + id);
                console.log("URL: " + jsonUrl);

                $.ajax({
                    url: jsonUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(data)
                    {
                        jsondata = data;
                        updateHtml(data);
						
                    }
                });
				
                return jsondata;
            }

            function updateHtml(yamjdata)
            {
                console.log(yamjdata);
                YAMJ_DIR = {
              //      'span.id': 'result.id',
                    'span.name': 'result.name',
                    'span.birthPlace': 'result.birthPlace',
					'span.birthDay': function(arg) {
								if (arg.context.result.birthDay) 
								{
									return arg.context.result.birthDay;
								} else {
								return nobirthday_text;
								}
							},
                    'span.biography': function(arg) {
								if (arg.context.result.biography) 
								{
									return arg.context.result.biography;
								} else {
								return nobiography_text;
								}
							},
                    'span.image': function(arg) {
                        // Check to see if there is artwork
                        if (arg.context.result.artwork) {
                            // Get the first photo from the list
                            var photo = arg.context.result.artwork[0];
                            if (photo.generatedId === 0) {
                                return "<img src=\"pictures/dummy_photo.jpg\">";
                            }
                            return "<img src=\"" + arg.context.basePhotoUrl + photo.filename + "\">";
                        } else {
                            return "<img src=\"pictures/dummy_photo.jpg\">";
                        }
                    }
                };
                $p('.template').render(yamjdata, YAMJ_DIR);

                var str = JSON.stringify(yamjdata, undefined, 4);
            //   output(str);
				
            }

            // Add the source output to the end of the page
            function output(inp) {
                document.body.appendChild(document.createElement('pre')).innerHTML = inp;
            }
//************************ LANGUAGE SETTING *********************************************		
		// include this function to set the skin language , fetched from the yamjv3 database configuration table 
		// before using this function skin_language varaible should declared with supported value  fr, en, de, es, it 
		// enter in the browser http://localhost:8888/yamj3/config/list.html
		// click on enter new configuration ()
		// enter skin_langauge as key
		// enter a valid value language as value 
		// click enter 
		function set_skin_language()
		{		
		var jsonSkinLangUrl = "http://localhost:8888/yamj3/system/config.json?config=skin_language&mode=any";
		console.log("jsonSkinLangUrl: " + jsonSkinLangUrl);
				$.ajax({
                   url: jsonSkinLangUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(dataSkinlanguage)
                   {
						jsondata = dataSkinlanguage;
					//	outputJson(dataSkinlanguage);
						updateSkinlang(dataSkinlanguage);
					}
			});	
			 return jsondata;
		}
		
		function updateSkinlang(yamjdata) {
				console.log(yamjdata);
				var WI = {
						"tr": {
							"list<-results":{
								"td.Value"				: function(arg) {
								set_lang_value (arg.item.value);
								return arg.item.value;
								}	
							}
						}
					};
				$p('.results').render( yamjdata, WI );			
			}					
		function set_lang_value (lang)
		{

			if (window.XMLHttpRequest)
			  {// code for IE7+, Firefox, Chrome, Opera, Safari
			  xmlhttp=new XMLHttpRequest();
			  }
			else
			  {// code for IE6, IE5
			  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			  }
			xmlhttp.open("GET","yamjv3_lang_"+lang+".xml",false);
			xmlhttp.send();
			xmlDoc=xmlhttp.responseXML; 
			x=xmlDoc.getElementsByTagName('lang');
			i=0;

			nobiography_text=(x[i].getElementsByTagName("nobiography")[0].childNodes[0].nodeValue);
			nobirthday_text=(x[i].getElementsByTagName("nobirthday")[0].childNodes[0].nodeValue);
		}
        </script>
		<!-- just added to set the language value, shouldn't be displayed  -->
			<div class="results" style="visibility: hidden; display:none;">
				<table><tr><td class="Value"></td></tr></table>
			</div>
			
        <div class="template">
            <table id="headertable">
                <tr>
                 
            <!--        <td><span class="id"></span></td> -->
                    <td rowspan="4"><span class="image"></span></td>
                    <td><span class="name"></span>: 
                    <span class="birthPlace"></span> - 
                    <span class="birthDay"></span></td>
                </tr>
                <tr>
               
                    <td><span class="biography"></span></td>
                </tr>
            </table>
        </div>
		
	

  <!--      <h4>Source data:</h4> -->
    </body>
</html>