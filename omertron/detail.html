<!doctype html>
<html>
    <head>
        <title>YAMJ v3</title>
        <script src="js/jquery.js"></script>
        <script src="js/pure.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css"/>
        <!--Slider stuff-->
        <link href="slideshow/slideshow.css" rel="stylesheet" type="text/css" />
        <script src="slideshow/slideshow.js" type="text/javascript"></script>
        <script src="slideshow/slideshowFanart.js" type="text/javascript"></script>
        <script type="text/javascript">
            var id = localStorage.getItem("id");
            var type = localStorage.getItem("type");
            var jsondata;
//			var jsonPersondata;
			var DETAIL_HEADER = {
				'span.header_title': 'result.title',
				'span.header_year': 'result.videoYear',
				'span.header_id': 'result.id'
						};
					
            var YAMJ_DIR = {

			//  'span.title': 'result.title',
            //  'span.year': 'result.videoYear',
                'span.plot': function(arg) {
				return "<b>Plot: </b>" +arg.context.result.plot;
				},
                'span.genres': function(arg)
                {
                    var genres = arg.context.result.genres;
                    var output = "<b>Genres: </b>";
                    var first = true;
                    for (i = 0; i < genres.length; i++) {
                        if (first) {
                            first = false;
                        } else {
                            output += ", ";
                        }
                        output += genres[i].name;
                    }
                    return output;
                },
              
               'img.fanart': {
                    'fanart<-result.artwork.FANART': {
                        '@src': function(arg)
                        {
                            // Check to see if there are fanart
                            if (arg.item) {
                                // Get the first fanart from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy.jpg";
                            }
                        }

                    }
                },
		 'img.poster': {
                    'poster<-result.artwork.POSTER': {
                        '@src': function(arg)
                        {
                            // Check to see if there are posters
                            if (arg.item) {
                                // Get the first poster from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy.jpg";
                            }
                        }

                    }
                }
            };
//			var YAMJ_PERSON = {
//						 'span.people': function(arg)
//							{
//								var persons = arg.context.result;
//								var output = "<b>People: </b>"+people;
//								return output;
//							},
//						};
            function getData()
            {
                   var jsonUrl = "http://localhost:8888/yamj3/api/video/" + type.toLowerCase() + "/" + id + ".json?dataitems=genre,artwork,plot";
                console.log("URL: " + jsonUrl);

                $.ajax({
                    url: jsonUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(data)
                    {
                        jsondata = data;
			updateHtml(data);
                        //getPersondata();
			//outputJson(data);
			// add slideshow for fanart
			slideshowFanart();
			// slideshow for poster
                        slideshow();
                    }
                });
                return jsondata;
            }
//         function getPersonData()
//            {
//                   var jsonPersonUrl = "http://localhost:8888/yamj3/api/person/movie" + "/" + id + ".json?";
//                console.log("URL: " + jsonPersonUrl);
//                $.ajax({
//                    url: jsonPersonUrl,
//                    async: false,
//                    dataType: 'jsonp',
//                    'success': function(dataPerson)
//                    {
//					  jsonPersondata = dataPerson;
//						updatePersonHtml(dataPerson);
//						outputJson(dataPerson);
//                    }
//                });
//                return jsonPersondata;
//            }
            function updateHtml(yamjdata)
            {
		$p('.header').render(yamjdata, DETAIL_HEADER);
                $p('.template').render(yamjdata, YAMJ_DIR);
            }
//			function updatePersonHtml(yamjdataPerson)
//            {
//				$p('.people').render(yamjdataPerson, YAMJ_PERSON);
//            }
            // Add the source output to the end of the page
            function outputJson(yamjdata)
            {
                var sourceData = document.getElementById("sourceData");
                sourceData.setAttribute("class", "code");
                sourceData.innerHTML = '<h4>Source data:</h4>';
                sourceData.appendChild(document.createElement('pre')).innerHTML = JSON.stringify(yamjdata, undefined, 4);
            }
//			function outputPersonJson(yamjdataPerson)
//            {
//                var sourceData = document.getElementById("sourceData");
//                sourceData.setAttribute("class", "code");
//                sourceData.innerHTML = '<h4>Source data:</h4>';
//                sourceData.appendChild(document.createElement('pre')).innerHTML = JSON.stringify(yamjdataPerson, undefined, 4);
//            }
        </script>
    </head>
    <body onload="getData();">

		<div class="header">
			<table>
				<tr>
			<!-- add header for movie name  -->
					<td id="home_left">
						<a href="./index.html" target="_blank">
							<img src="./pictures/yamj-logo_repeat.png" width="150px">
						</a>
					</td>
					<td id="home_right">
						<a href="./index.html" target="_blank">
							<img src="./pictures/yamj-logo_repeat.png" width="150px">
						</a>
					</td>
					<td width="850px">
						<span class="header_title"></span> (<span class="header_year"></span>) -id: <span class="header_id"></span>
					</td>
				</tr>
			</table>
		</div>

        <div class="template">
		<!-- main table for detail page -->
            <table>
                  <tbody>
                    <tr>     
			<td rowspan="10">
                            <div id="slideshowFanart" class="glow">
                                <div id="imgRollFanart">
                                    <img class="fanart" src=""/>
                                </div>
                            </div>
                            <a id="nextFanart">=></a>
                            <a id="prevFanart"><=</a>
                        </td>
			<td rowspan="10">
                            <div id="slideshowCtr" class="glow">
                                <div id="imgRoll">
                                    <img class="poster" src=""/>
                                </div>
                            </div>
                            <a id="next">=></a>
                            <a id="prev"><=</a>
                        </td>        
                    </tr>
			<!-- split table for image and text --> 
			<table>
				<tr>
					<td><span class="plot"></span></td>
				</tr>
				<tr>
					<td><span class="genres"></span></td>
				</tr>
<!--						<tr>
							<td><span class="people"></span></td>
						</tr> -->
			</table>
                </tbody>
            </table>
        </div>
        <div id="sourceData"></div>
    </body>
</html>
