<!doctype html>
<html>
    <head>
        <title>YAMJ v3</title>
        <script src="js/jquery.js"></script>
        <script src="js/pure.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css"/>
        <!--Slider stuff-->
        <link href="slideshow/slideshow.css" rel="stylesheet" type="text/css" />
        <script src="slideshow/slideshow.js" type="text/javascript"></script>
        <script src="slideshow/slideshowFanart.js" type="text/javascript"></script>
        <script type="text/javascript">
            var id = localStorage.getItem("id");
            var type = localStorage.getItem("type");
            var jsondata;
			var jsonPersondata;
			var DETAIL_HEADER = {
							'span.header_type': 'result.videoType',
							'span.header_title': 'result.title',
							'span.header_year': 'result.videoYear',
							'span.header_id': 'result.id'
						};
					
            var YAMJ_DIR = {
                'span.plot': function(arg) {
					if (arg.context.result.plot) {
							return "<text>PLOT</text>" +arg.context.result.plot;
								} else {
							return "<text>NO PLOT AVALAIBLE</text>";
							}
				},
                'span.genres': function(arg)
                {
                    var genres = arg.context.result.genres;
                    var output = "<text>GENRE</text>";
                    var first_genres = true;
                    for (i = 0; i < genres.length; i++) {
                        if (first_genres) {
                            first_genres = false;
                        } else {
                            output += ", ";
                        }
                        output += genres[i].name;
                    }
                    return output;
                },
              
               'img.fanart': {
                    'fanart<-result.artwork.FANART': {
                        '@src': function(arg)
                        {
                            // Check to see if there are fanart
                            if (arg.item) {
                                // Get the first fanart from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy_fanart.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy_fanart.jpg";
                            }
                        }

                    }
                },
				  'img.poster': {
                    'poster<-result.artwork.POSTER': {
                        '@src': function(arg)
                        {
                            // Check to see if there are posters
                            if (arg.item) {
                                // Get the first poster from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy.jpg";
                            }
                        }

                    }
                }
            };
		

			var	ACTOR_NAME = {
							'td' : 
							{	
								"result<-results":{				
									"span.actor-name"		: "result.name" 
								}
							}
						};			
						
			var	ACTOR_ROLE = {
							'td' : 
							{
								"result<-results":{	
									"span.actor-role"		: function(arg)   {
										if (arg.item.role) {
													return arg.item.role;
												} else {
													return arg.item.job.substr(0,1)+arg.item.job.substr(1).toLowerCase();
												}	
										}
								}
							}
						};					

			var YAMJ_CREW = {
						'span.totalcrew': function(arg)   {
							var totalactors = arg.context.results;
							var outputTotalActor = "";
							var first_total = true;
							for (i = 0; i < totalactors.length; i++) {
							
							if (first_total) {
								first_total = false;
								} else {
								outputTotalActor += "<br />";
								}
								outputTotalActor += "<span>"+totalactors[i].name+"</span>";
								if (totalactors[i].role) {
													outputTotalActor += "<span style=\"font-size:0.8em\"> ("+totalactors[i].role+")</span>";
												} else {
													outputTotalActor += "<span style=\"font-size:0.8em\"> ("+totalactors[i].job.substr(0,1)+totalactors[i].job.substr(1).toLowerCase()+")</span>";}
								if (totalactors[i].birthPlace) {
													outputTotalActor += "<span style=\"font-size:0.8em\"> - "+totalactors[i].birthPlace+"</span>";}
								if (totalactors[i].birthDay) {
													outputTotalActor += "<span style=\"font-size:0.8em\"> - "+totalactors[i].birthDay+"</span>";}			
									if (i < 11) {
									get_photo (totalactors[i].id, i);
									}
								}
                  				return outputTotalActor;
							}
						};
						
				var YAMJ_PHOTO = {
							'img.photo@src': function(arg) {  
							 
								if (arg.context.result.artwork[0])
								{
									return arg.context.basePhotoUrl + arg.context.result.artwork[0].filename;
									} else {                              
									
									return "pictures/dummy_photo.jpg";
									}
							}
						};
            function getData()
            {	   
					var jsonUrl = "http://localhost:8888/yamj3/api/video/" + type.toLowerCase() + "/" + id + ".json?dataitems=genre,artwork,plot";
                console.log("URL: " + jsonUrl);
					var jsonActorUrl = "http://localhost:8888/yamj3/api/person/" + type.toLowerCase() + ".json?id=" + id + "&job=ACTOR,Director,Writer&start=-1&max=11";
                console.log("URL: " + jsonActorUrl);
					var jsonCrewUrl = "http://localhost:8888/yamj3/api/person/" + type.toLowerCase() + ".json?id=" + id + "&job=Actor,Director,Writer";
                console.log("URL: " + jsonCrewUrl);
                $.ajax({
                    url: jsonUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(data)
                    {
                        jsondata = data;
		            //  outputJson(data);                
						$p('.header').render(data, DETAIL_HEADER);
						$p('.template').render(data, YAMJ_DIR); 
					
	
						// add slideshow for fanart
						slideshowFanart();
						// slideshow for poster
                        slideshow();
						// display all actor only
						crewshow ();
				}
                });
                $.ajax({
                    url: jsonCrewUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(dataCrew)
                    {
						jsondata = dataCrew;
					//	outputJson(dataCrew);
                    $p('.crew').render(dataCrew, YAMJ_CREW);
					}
                });
                $.ajax({
                    url: jsonActorUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(dataActor)
                    {
						jsondata = dataActor;
					//	outputJson(dataActor);
						$p('.table_actor_name').render(dataActor, ACTOR_NAME);
						$p('.table_actor_role').render(dataActor, ACTOR_ROLE);
					}
                });
	            
            }
  
            // Add the source output to the end of the page
            function outputJson(yamjdata)
            {
                var sourceData = document.getElementById("sourceData");
                sourceData.setAttribute("class", "code");
                sourceData.innerHTML = '<h4>Source data:</h4>';
                sourceData.appendChild(document.createElement('pre')).innerHTML = JSON.stringify(yamjdata, undefined, 4);
            }
	function crewshow() {	// on actor hover show all actor

				$('.showcrew').hover(function() {
					$('.plot').css('visibility', 'hidden');
					$('.genres').css('visibility', 'hidden');
					$('.crew').css('visibility', 'visible');
					$('.actorinfo').css('display', 'none');
					$('.totalcrew').css('display', 'block');
					
				}, function() {
					$('.plot').css('visibility', 'visible');
					$('.genres').css('visibility', 'visible');
					$('.crew').css('visibility', 'hidden');
					$('.actorinfo').css('display', 'block');
					$('.totalcrew').css('display', 'none');
			//		actortotalshow();
				});
			}
	// not used to be implemented later 			
	function actortotalshow() {	// on all actor hover to be implemented 
				$('.totalcrew').hover(function() {
					$('.plot').css('visibility', 'hidden');
					$('.genres').css('visibility', 'hidden');
					$('.crew').css('visibility', 'hidden');
					$('.actorinfo').css('display', 'none');
					$('.totalcrew').css('display', 'block');
					
				}, function() {
					$('.plot').css('visibility', 'visible');
					$('.genres').css('visibility', 'visible');
					$('.crew').css('visibility', 'visible');
					$('.actorinfo').css('display', 'block');
					$('.totalcrew').css('display', 'none');
					});
			}
	function change_movie(x)
        {
            localStorage.setItem("type", type);
			if (x == 'next')
			{
				localStorage.setItem("id", parseInt(id, 10) + 1);
				console.log("Storing value: " + type + "-" + (parseInt(id, 10) + 1));
				} else {
				localStorage.setItem("id", parseInt(id, 10) - 1);
				console.log("Storing value: " + type + "-" + (parseInt(id, 10) - 1));
				};	
            console.log("Storing value: " + type + "-" + id);
            window.location.href="detail.html";
        }

	function get_photo(actor_id, rank)
		{
			var jsonPhotoUrl = "http://localhost:8888/yamj3/api/person/" + actor_id + ".json?dataitems=artwork";
                console.log("URL: " + jsonPhotoUrl + rank);
				$.ajax({
                    url: jsonPhotoUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(photodata)
                    {
                        jsonphotodata = photodata;
		              // outputJson(photodata); 
						if (rank == 0){
					// by default all images are hidden for the case if there is nothing to display,  
					// if this part is running, image is validate then reset this photo to visible
							$('.photo0 img').css('visibility', 'visible');
							$p('.photo0').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 1){
							$('.photo1 img').css('visibility', 'visible');
							$p('.photo1').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 2){
							$('.photo2 img').css('visibility', 'visible');
							$p('.photo2').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 3){
							$('.photo3 img').css('visibility', 'visible');
							$p('.photo3').render(photodata, YAMJ_PHOTO);
							}	
						if (rank == 4){
							$('.photo4 img').css('visibility', 'visible');
							$p('.photo4').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 5){
							$('.photo5 img').css('visibility', 'visible');
							$p('.photo5').render(photodata, YAMJ_PHOTO);
							}	
						if (rank == 6){
							$('.photo6 img').css('visibility', 'visible');
							$p('.photo6').render(photodata, YAMJ_PHOTO);
							}	
						if (rank == 7){
							$('.photo7 img').css('visibility', 'visible');
							$p('.photo7').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 8){
							$('.photo8 img').css('visibility', 'visible');
							$p('.photo8').render(photodata, YAMJ_PHOTO);
							}
						if (rank == 9){
							$('.photo9 img').css('visibility', 'visible');
							$p('.photo9').render(photodata, YAMJ_PHOTO);
							}	
						if (rank == 10){
							$('.photo10 img').css('visibility', 'visible');
							$p('.photo10').render(photodata, YAMJ_PHOTO);
							}	
					}
                });
		}
        </script>
    </head>
    <body onload="getData();">
	<!-- navigation to index -->
		<div id="logo">
 					
						<a id="home_right" href="./index_series.html">
							<img src="./pictures/yamj-logo_tv.png" width="100px" />
						</a>
						<a id="home_left" href="./index_movie.html">
							<img src="./pictures/yamj-logo_movie.png" width="100px" />
						</a>
	<!-- navigation to next/previous movie which doesn't take care of the selection before in index --> 
	<!-- need to be revue -->
						<input id="previous_movie" type="button" class="button" onclick="change_movie('previous')" value="" />
						<input id="next_movie" type="button" class="button" onclick="change_movie('next')" value="" />		
        </div>
	<!--  header for movie name -->
		<div class="header">
			<table>
				<tr>
	
					<td width="850px">
						<span class="header_type"></span>
						<span class="header_title"></span>
						<span class="header_text"> (</span>
						<span class="header_year"></span>
						<span class="header_text">) id:</span>
						<span class="header_id" ></span>
						</td>
				</tr>
			</table>
		</div>
		
		
		<div class="showcrew">
					<td><span >ALL CREW</span></td>
		</div>

        <div class="template"> 
		<!-- main table for detail page -->
           <table>
                  <tbody>
                    <tr>     
						<td rowspan="10">
                            <div id="slideshowFanart" class="glow">
                                <div id="imgRollFanart">
                                    <img class="fanart" src=""/>
                                </div>
                            </div>
                            <a id="nextFanart">=></a>
                            <a id="prevFanart"><=</a>
                        </td>
						<td rowspan="10">
                            <div id="slideshowCtr" class="glow">
                                <div id="imgRoll">
                                    <img class="poster" src=""/>
                                </div>
                            </div>
                            <a id="next"><img src="./pictures/next.png" /></a>
                            <a id="prev"><img src="./pictures/previous.png" /></a>
                        </td>        
                    </tr> 
			<!-- split table for image and text --> 
				
			<!-- add class for each object in the detail section of yamj-style.css -->
					<table>
						<tr >
							<td ><span class="plot"></span></td>
						</tr>
						<tr>
							<td><span class="genres"></span></td>
						</tr>
					
					</table>
                </tbody>
            </table> 
			<div>
				<table>
					<tr>
						<td class="photo0"><img class="photo" src=""/></td>
						<td class="photo1"><img class="photo" src=""/></td>
						<td class="photo2"><img class="photo" src=""/></td>
						<td class="photo3"><img class="photo" src=""/></td>
						<td class="photo4"><img class="photo" src=""/></td>
						<td class="photo5"><img class="photo" src=""/></td>
						<td class="photo6"><img class="photo" src=""/></td>
						<td class="photo7"><img class="photo" src=""/></td>
						<td class="photo8"><img class="photo" src=""/></td>
						<td class="photo9"><img class="photo" src=""/></td>
						<td class="photo10"><img class="photo" src=""/></td>
					</tr>
				</table>
			</div>
        </div>
		<div class="table_actor_name">
			<table id="tableactorname">	
				<tr>
					<td class="center">
						<span class="actor-name"></span>
					</td>
				</tr>
			</table>
		</div>
		<div class="table_actor_role">
			<table id="tableactorrole">	
				<tr>
					<td class="center">
						(<span class="actor-role"></span>)
					</td>
				</tr>
			</table>
		</div>

			<div class="crew">
				<tr>
					<td><span class="totalcrew"></span></td>
				</tr> 
			</div>

        <div id="sourceData"></div>
    </body>
</html>