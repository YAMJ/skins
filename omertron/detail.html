<!doctype html>
<html>
    <head>
        <title>YAMJ v3</title>
        <script src="js/jquery.js"></script>
        <script src="js/pure.js"></script>
        <link rel="stylesheet" type="text/css" href="css/yamj-style.css"/>
        <!--Slider stuff-->
        <link href="slideshow/slideshow.css" rel="stylesheet" type="text/css" />
        <script src="slideshow/slideshow.js" type="text/javascript"></script>
        <script src="slideshow/slideshowFanart.js" type="text/javascript"></script>
        <script type="text/javascript">
            var id = localStorage.getItem("id");
            var type = localStorage.getItem("type");
            var jsondata;
            var YAMJ_DIR = {
                'span.id': 'result.id',
                'span.title': 'result.title',
                'span.year': 'result.videoYear',
                'span.plot': 'result.plot',
                'span.genres': function(arg)
                {
                    var genres = arg.context.result.genres;
                    var output = "";
                    var first = true;
                    for (i = 0; i < genres.length; i++) {
                        if (first) {
                            first = false;
                        } else {
                            output += ", ";
                        }
                        output += genres[i].name;
                    }
                    return output;
                },
                'img.poster': {
                    'poster<-result.artwork.POSTER': {
                        '@src': function(arg)
                        {
                            // Check to see if there are posters
                            if (arg.item) {
                                // Get the first poster from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy.jpg";
                            }
                        }

                    }
                },
               'img.fanart': {
                    'fanart<-result.artwork.FANART': {
                        '@src': function(arg)
                        {
                            // Check to see if there are fanart
                            if (arg.item) {
                                // Get the first fanart from the list
                                if (arg.item.generatedId === 0) {
                                    return "pictures/dummy.jpg";
                                }
                                return arg.context.baseArtworkUrl + arg.item.filename;
                            } else {
                                return "pictures/dummy.jpg";
                            }
                        }

                    }
                }
            };

            function getData()
            {
                var jsonUrl = "http://localhost:8888/yamj3/api/video/" + type.toLowerCase() + "/" + id + ".json";
                console.log("URL: " + jsonUrl);

                $.ajax({
                    url: jsonUrl,
                    async: false,
                    dataType: 'jsonp',
                    'success': function(data)
                    {
                        jsondata = data;
                        updateHtml(data);
                        //outputJson(data);
						// slideshow for poster
                        slideshow();
						// add slideshow for fanart
						slideshowFanart();
                    }
                });
                return jsondata;
            }

            function updateHtml(yamjdata)
            {
                $p('.template').render(yamjdata, YAMJ_DIR);
            }

            // Add the source output to the end of the page
            function outputJson(yamjdata)
            {
                var sourceData = document.getElementById("sourceData");
                sourceData.setAttribute("class", "code");
                sourceData.innerHTML = '<h4>Source data:</h4>';
                sourceData.appendChild(document.createElement('pre')).innerHTML = JSON.stringify(yamjdata, undefined, 4);
            }

        </script>
    </head>
    <body onload="getData();">

        <div id="logo">
            <br>
            <h1>Detail Page</h1>
            <br>
        </div>

        <div class="template">
		<!-- main table for detail page -->
            <table>
                <col width="400px">
                <tbody>
                    <tr>
                        <td rowspan="10">
                            <div id="slideshowCtr" class="glow">
                                <div id="imgRoll">
                                    <img class="poster" src=""/>
                                </div>
                            </div>
                            <a id="next">=></a>
                            <a id="prev"><=</a>
                        </td>                 
						<td rowspan="10">
                            <div id="slideshowFanart" class="glow">
                                <div id="imgRollFanart">
                                    <img class="fanart" src=""/>
                                </div>
                            </div>
                            <a id="nextFanart">=></a>
                            <a id="prevFanart"><=</a>
                        </td>
                    </tr>
			<!-- split table for image and text --> 
					<table>
						<tr>
			<!-- add class for each object in the detail section of yamj-style.css -->
							<td class="id"><b>ID: </b></td><td><span class="id"></span></td>
					   
							<td class="title"><b>Title: </b><span class="title"></span></td>
				
							<td class="year"><b>Year: </b><span class="year"></span></td>
						</tr>
						</table>
						<table>
						<tr>
							<td align="left"><b>Plot: </b></td>
							<td><span class="plot"></span></td>
						</tr>
						<tr>
							<td align="right"><b>Genres: </b></td>
							<td>
								<span class="genres"></span>
							</td>
						</tr>
					</table>
                </tbody>
            </table>
        </div>
        <div id="sourceData"></div>
    </body>
</html>
