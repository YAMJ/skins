<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>YAMJ v3 index person</title>
        <script src="js/jquery.js"></script>
        <!-- Used for the JSON parsing -->
        <script src="js/pure.js"></script>
        <!-- Used for the paging of the index -->
        <script src="js/js.js"></script>
        <script src="js/jPages.js"></script>

        <link rel="stylesheet" type="text/css" href="css/yamj-style.css">
        <!-- Used for the paging of the index -->
        <link rel="stylesheet" href="css/jPages.css">
        <!-- Used for the fancy animations -->
        <link rel="stylesheet" href="css/animate.css">
    </head>
    <body onload="getIndexData();">
        <script type="text/javascript">
//************************ LANGUAGE SETTING *********************************************
		// SET THE LANGUAGE HERE fr, en, de
		var lang = "fr"; 
		// all the other pages will take this setting 	
		localStorage.setItem("lang", lang);
//***************************************************************************************
        var perPageValue = 30;
        var jsondata = null;
		var index_type = "movie,series";
		var index_method = "START";
		if (localStorage.getItem("indextype"))
			{index_type = localStorage.getItem("indextype");}
		// get the search method and reset to default for the next time 
		if (localStorage.getItem("search_method"))
			{index_method = localStorage.getItem("search_method");
			localStorage.setItem("search_method", "START");}
        // This is the directive used by pure to transform the JSON data into HTML
        // span.Title is a simple substitution of the title
        // img.Poster@src replaces the "src" attribute of the img.Poster
        var LIST_DIR = {
            "div.person_block": {
                "result<-results": {
                    "span.person_name": "result.name",
                    "img.person_photo@src": function(arg) {
                        // Check to see if there are posters
                        if (arg.item.artwork.PHOTO) {
                            // Get the first poster from the list
                            var photo = arg.item.artwork.PHOTO[0];
                            if (photo.generatedId === 0) {
                                return "pictures/dummy_photo.jpg";
                            }
                            return arg.context.basePhotoUrl + photo.filename;
                        } else {
                            return "pictures/dummy_photo.jpg";
                        }
                    },
                    "img.person_photo@onclick": function(arg) {
                        return "open_person_popup('" + arg.item.id + "')";
                    }
                }
            }
        };
		
		
	function open_person_popup(id)
        {
            localStorage.setItem("Person_id", id);
            console.log("Storing value: Person_id"  + id);
			Mypopup = window.open("Popup_Person.html", "YAMJ v3 Person popup","channelmode=no, menubar=no, status=no, scrollbars=no, menubar=no, location=no, left=310px, top=5px, width=1100px, height=340px");
			Mypopup.focus();
		}
    
        // This function calls the API to get the JSON data.
        // It will then update the HTML with the data and set up the paging
        function getIndexData()
        {
			// fill all value according to language setting - from yamjv3_lang_{lang}.xml
			set_lang_value (localStorage.getItem("lang"));
            var jsonUrl = "http://localhost:8888/yamj3/api/index/person.json?sortby=name&sortdir=asc";
			
			
			var select = localStorage.getItem("search_index");
			if (select != "") {
					selected_index = person_label +" (" +select+ ")"
					
					jsonUrl = jsonUrl + "&search=" + select + "&field=name&mode="+index_method;
					localStorage.setItem("search_index", "");	
				} else {
					selected_index = person_label;
						}
			$('#printsearch').html(selected_index);
            console.log("URL: " + jsonUrl);

            $.ajax({
                url: jsonUrl,
                async: false,
                dataType: 'jsonp',
                'success': function(data)
                {
                    jsondata = data;
					
                    updateHtml(data);
                    pageData(perPageValue);
                }
            });
            return jsondata;
        }

        // Run the pure.js function to render the data into the HTML template
        // div.row is the part of the template to apply it too.
        // "row" is a CLASS attribute, not the id.
        function updateHtml(yamjdata)
        {
            $p('div.row').render(yamjdata, LIST_DIR);
        }

        // Create the pagination for the index using jPages.
        // Will place the page list in the "div.holder" and page the "yRow" data.
        // Animation comes from animate.css
        function pageData(perPage)
        {
            $("div.holder").jPages({
                containerID: "yRow",
                animation: "fadeInUpBig",
                perPage: perPage,
                delay: 20
            });
        }
		function SetIndexData (search)
		{		
				localStorage.setItem("search_index", search);
				window.location.reload();
		
		}
		
		function CallIndex (indextype)
		{		
				localStorage.setItem("indextype", indextype);
				console.log("callindex: " + indextype);
				window.location.href="index.html";
		}
		
	
	
		// store all value according to language setting - from yamjv3_lang_{lang}.xml
		function set_lang_value (lang)
		{

			if (window.XMLHttpRequest)
			  {// code for IE7+, Firefox, Chrome, Opera, Safari
			  xmlhttp=new XMLHttpRequest();
			  }
			else
			  {// code for IE6, IE5
			  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
			  }
			xmlhttp.open("GET","yamjv3_lang_"+lang+".xml",false);
			xmlhttp.send();
			xmlDoc=xmlhttp.responseXML; 
			x=xmlDoc.getElementsByTagName('lang');
			i=0;

			all_select=(x[i].getElementsByTagName("allselected")[0].childNodes[0].nodeValue);
			document.getElementById("allselect").innerHTML=all_select.toUpperCase();
			
			movie_select=(x[i].getElementsByTagName("movieselected")[0].childNodes[0].nodeValue);
			document.getElementById("movieselect").innerHTML=movie_select.toUpperCase();
			
			series_select=(x[i].getElementsByTagName("serieselected")[0].childNodes[0].nodeValue);
			document.getElementById("serieselect").innerHTML=series_select.toUpperCase();
			
			season_select=(x[i].getElementsByTagName("seasonselected")[0].childNodes[0].nodeValue);
			document.getElementById("seasonselect").innerHTML=season_select.toUpperCase();
			
			start_label=(x[i].getElementsByTagName("startlabel")[0].childNodes[0].nodeValue);
			document.getElementById("startlabel").innerHTML=start_label.toUpperCase();
			
			any_label=(x[i].getElementsByTagName("anylabel")[0].childNodes[0].nodeValue);
			document.getElementById("anylabel").innerHTML=any_label.toUpperCase();
			
			series_label=(x[i].getElementsByTagName("serieslabel")[0].childNodes[0].nodeValue);
			season_label=(x[i].getElementsByTagName("seasonlabel")[0].childNodes[0].nodeValue);
			person_label=(x[i].getElementsByTagName("personlabel")[0].childNodes[0].nodeValue);
		}
        </script>

        <div id="logo">
<!--            <h1>YAMJv3 Index</h1>
			 navigation beetween movie end series -->		
						<a id="home_right_up" href="javascript:CallIndex('series')">
							<img src="./pictures/yamj-logo_repeat.png" width="90px"></img><div id="serieselect"></div>
						</a>
						<a id="home_right_down" href="javascript:CallIndex('season')">
							<img src="./pictures/yamj-logo_repeat.png" width="90px"></img><div id="seasonselect"></div>
						</a>
						<a id="home_left_up" href="javascript:CallIndex('movie,series')">
							<img src="./pictures/yamj-logo_repeat.png" width="90px"></img><div id="allselect"></div>
						</a>
						<a id="home_left_down" href="javascript:CallIndex('movie')">
							<img src="./pictures/yamj-logo_repeat.png" width="90px"></img><div id="movieselect"></div>
						</a>
			<div class="show_personindex"><span id="printsearch"></span></div>				
		<!-- search by letter -->				
						
			<form id="monForm">
				<fieldset>
					<table align="center">
						<tr>
							<td class="formSelect">							
								<input  type="button" value="A" onclick="SetIndexData('a')"/>
								<input  type="button" value="B" onclick="SetIndexData('b')"/>
								<input  type="button" value="C" onclick="SetIndexData('c')"/>
								<input  type="button" value="D" onclick="SetIndexData('d')"/>
								<input  type="button" value="E" onclick="SetIndexData('e')"/>
								<input  type="button" value="F" onclick="SetIndexData('f')"/>
								<input  type="button" value="G" onclick="SetIndexData('g')"/>
								<input  type="button" value="H" onclick="SetIndexData('h')"/>
								<input  type="button" value="I" onclick="SetIndexData('i')"/>
								<input  type="button" value="J" onclick="SetIndexData('j')"/>
								<input  type="button" value="K" onclick="SetIndexData('k')"/>
								<input  type="button" value="L" onclick="SetIndexData('l')"/>
								<input  type="button" value="M" onclick="SetIndexData('m')"/>
								<input  type="button" value="N" onclick="SetIndexData('n')"/>
								<input  type="button" value="O" onclick="SetIndexData('o')"/>
								<input  type="button" value="P" onclick="SetIndexData('p')"/>
								<input  type="button" value="Q" onclick="SetIndexData('q')"/>
								<input  type="button" value="R" onclick="SetIndexData('r')"/>
								<input  type="button" value="S" onclick="SetIndexData('s')"/>
								<input  type="button" value="T" onclick="SetIndexData('t')"/>
								<input  type="button" value="U" onclick="SetIndexData('u')"/>
								<input  type="button" value="V" onclick="SetIndexData('v')"/>
								<input  type="button" value="W" onclick="SetIndexData('w')"/>
								<input  type="button" value="X" onclick="SetIndexData('x')"/>
								<input  type="button" value="Y" onclick="SetIndexData('y')"/>
								<input  type="button" value="Z" onclick="SetIndexData('z')"/>
							<td>
						</tr>
						<tr>
							
							<td align="right">
								<input  type="button" value="1" onclick="SetIndexData('1')"/>
								<input  type="button" value="2" onclick="SetIndexData('2')"/>
								<input  type="button" value="3" onclick="SetIndexData('3')"/>
								<input  type="button" value="4" onclick="SetIndexData('4')"/>
								<input  type="button" value="5" onclick="SetIndexData('5')"/>
								<input  type="button" value="6" onclick="SetIndexData('6')"/>
								<input  type="button" value="7" onclick="SetIndexData('7')"/>
								<input  type="button" value="8" onclick="SetIndexData('8')"/>
								<input  type="button" value="9" onclick="SetIndexData('9')"/>
								<input  type="button" value="0" onclick="SetIndexData('0')"/>
						
								<input  type="button" value="ALL" onclick="SetIndexData('')"/>
								<input  type="text" id="FormSearch" />
								<input  type="submit" onclick="SetIndexData(this.form.FormSearch.value); "/>
							</td>
						</tr>
						<table class="tablesearchmethod">
						<tr>
							<td>
								<input type="radio" name="search_method" value="START" onclick="localStorage.setItem('search_method', 'START');" id="FormStart" checked="checked" /><label for="START"><div id='startlabel'></div></label></td>
								<td><input type="radio" name="search_method" value="ANY" onclick="localStorage.setItem('search_method', 'ANY')" id="FormAny" /> <label for="ANY"><div id='anylabel'></div></label>
							</td> 
						</tr>
						</table>
					</table>
				</fieldset>
			</form>
            <!--Navigation Holder-->
            <div class="holder"></div>
					
        </div>
        <!--Data Items Container-->
        <div id="container">
            <div id="yRow" class="row">
                <div id="yBlock" class="person_block">
                    <img class="person_photo" src=""><br>
                    <span class="person_name"></span>
                </div>
                <br />
            </div>
        </div>

    </body>
</html>
